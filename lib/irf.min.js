!function(t){if("object"==typeof exports)module.exports=t();else if("function"==typeof define&&define.amd)define(t);else{var e;"undefined"!=typeof window?e=window:"undefined"!=typeof global?e=global:"undefined"!=typeof self&&(e=self),e.irf=t()}}(function(){return function t(e,r,i){function n(s,h){if(!r[s]){if(!e[s]){var a="function"==typeof require&&require;if(!h&&a)return a(s,!0);if(o)return o(s,!0);throw new Error("Cannot find module '"+s+"'")}var c=r[s]={exports:{}};e[s][0].call(c.exports,function(t){var r=e[s][1][t];return n(r?r:t)},c,c.exports,t,e,r,i)}return r[s].exports}for(var o="function"==typeof require&&require,s=0;s<i.length;s++)n(i[s]);return n}({1:[function(t,e){var r,i;i=t("./vector.coffee"),r=function(){function t(t,e,r){this.coor=t,this.dim=e,this.color=null!=r?r:"grey",null==this.coor&&(this.coor=new i),null==this.dim&&(this.dim=new i)}return t.prototype.intersect=function(t){return null==t?!1:this.intersectv(t)&&this.intersecth(t)},t.prototype.intersectv=function(t){return this.coor.y<t.coor.y?(this.dim.y+t.dim.y)/2<t.coor.y-this.coor.y?!1:!0:(this.dim.y+t.dim.y)/2<this.coor.y-t.coor.y?!1:!0},t.prototype.intersecth=function(t){return this.coor.x<t.coor.x?(this.dim.x+t.dim.x)/2<t.coor.x-this.coor.x?!1:!0:(this.dim.x+t.dim.x)/2<this.coor.x-t.coor.x?!1:!0},t.prototype.render=function(t){return t.strokeStyle=this.color,t.strokeRect(this.coor.x-this.dim.x/2,this.coor.y-this.dim.y/2,this.dim.x,this.dim.y)},t}(),e.exports=r},{"./vector.coffee":21}],2:[function(t,e){var r,i;i=t("./vector.coffee"),r=function(){function t(t,e,r){this.coor=t,this.dim=e,this.color=null!=r?r:"grey",null==this.coor&&(this.coor=new i),null==this.dim&&(this.dim=new i)}return t.prototype.intersect=function(t){return null==t?!1:this.intersectv(t)&&this.intersecth(t)},t.prototype.intersectv=function(t){return this.coor.y<t.coor.y?(this.dim.y+t.dim.y)/2<t.coor.y-this.coor.y?!1:!0:(this.dim.y+t.dim.y)/2<this.coor.y-t.coor.y?!1:!0},t.prototype.intersecth=function(t){return this.coor.x<t.coor.x?(this.dim.x+t.dim.x)/2<t.coor.x-this.coor.x?!1:!0:(this.dim.x+t.dim.x)/2<this.coor.x-t.coor.x?!1:!0},t.prototype.render=function(t){return t.strokeStyle=this.color,t.strokeRect(this.coor.x-this.dim.x/2,this.coor.y-this.dim.y/2,this.dim.x,this.dim.y)},t}(),e.exports=r},{"./vector.coffee":21}],3:[function(t,e){var r,i;i=t("./vector.coffee"),r=function(){function t(t){var e;this.projection=t.projection,this.vpWidth=t.vpWidth,this.vpHeight=t.vpHeight,this.zoomFactor=null!=(e=t.zoomFactor)?e:1,this.coor=new i(100,100)}return t.prototype.update=function(){},t.prototype.apply=function(t,e){switch(this.projection){case"normal":return t.save(),t.translate(this.vpWidth/2-this.coor.x,this.vpHeight/2-this.coor.y),e(),t.restore();case"iso":return t.save(),t.scale(1,.5),t.rotate(Math.PI/4),t.translate(this.vpWidth/2-this.coor.x,this.vpHeight/2-this.coor.y),e(),t.restore()}},t}(),e.exports=r},{"./vector.coffee":21}],4:[function(t,e){var r;r=function(){function t(){this.eventlist={},this.on=this.register}return t.prototype.register=function(t,e){return null==this.eventlist[t]&&(this.eventlist[t]=[]),this.eventlist[t].push(e)},t.prototype.trigger=function(t,e){var r,i,n,o,s;for(o=this.eventlist[t],s=[],i=0,n=o.length;n>i;i++)r=o[i],s.push(r(e));return s},t}(),e.exports=r},{}],5:[function(t,e){var r,i,n,o=function(t,e){return function(){return t.apply(e,arguments)}};n=t("./scenemanager.coffee"),i=t("./helpers.coffee"),r=function(){function t(t){this.gameloop=o(this.gameloop,this);var e;this.params=i.extend({width:800,height:600},t),e=document.createElement("canvas"),e.setAttribute("width",this.params.width),e.setAttribute("height",this.params.height),document.querySelector("body").appendChild(e),this.ctx=e.getContext("2d"),this.ctx.font="400 18px Helvetica, sans-serif",this.sceneManager=this.constructor.sceneManager||new n}return t.addScene=function(t){return null==this.sceneManager&&(this.sceneManager=new n),this.sceneManager.addScene(t)},t.prototype.gameloop=function(t){return this.delta=t-this.lasttime,this.lasttime=t,this.update(this.delta),this.render(),this.loopID?this.loopID=requestAnimationFrame(this.gameloop):void 0},t.prototype.start=function(){return this.lasttime=performance.now(),this.loopID=requestAnimationFrame(this.gameloop)},t.prototype.stop=function(){return cancelAnimationFrame(this.loopID),this.loopID=void 0},t.prototype.update=function(){},t.prototype.render=function(){return this.ctx.clearRect(0,0,this.params.width,this.params.height)},t}(),e.exports=r},{"./helpers.coffee":6,"./scenemanager.coffee":15}],6:[function(t,e){var r;Array.prototype.shuffle=function(){return this.sort(function(){return.5-Math.random()})},Number.prototype.toHex=function(t){var e;for(null==t&&(t=2),e=this.toString(16);e.length<t;)e="0"+e;return e},r=function(){function t(){}return t.extend=function(t,e){var r,i;for(r in e)i=e[r],t[r]=i;return t},t}(),e.exports=r},{}],7:[function(t,e){e.exports={Animation:t("./sprite/animation.coffee"),Background:t("./sprite/background.coffee"),BoundingBox:t("./boundingbox.coffee"),Camera:t("./camera.coffee"),EventManager:t("./eventmanager.coffee"),Game:t("./game.coffee"),Helpers:t("./helpers.coffee"),Keyboard:t("./keyboard.coffee"),Map:t("./map/map.coffee"),Scene:t("./scene.coffee"),SceneManager:t("./scenemanager.coffee"),Shape:t("./sprite/shape.coffee"),Sprite:t("./sprite/sprite.coffee"),Tile:t("./map/tile.coffee"),Timer:t("./timer.coffee"),Vector:t("./vector.coffee")}},{"./boundingbox.coffee":2,"./camera.coffee":3,"./eventmanager.coffee":4,"./game.coffee":5,"./helpers.coffee":6,"./keyboard.coffee":8,"./map/map.coffee":10,"./map/tile.coffee":13,"./scene.coffee":14,"./scenemanager.coffee":15,"./sprite/animation.coffee":16,"./sprite/background.coffee":17,"./sprite/shape.coffee":18,"./sprite/sprite.coffee":19,"./timer.coffee":20,"./vector.coffee":21}],8:[function(t,e){var r;r=function(){function t(){var t,e,r,i,n=this;this.mapping={8:"backspace",9:"tab",13:"return",16:"shift",17:"ctrl",18:"alt",27:"esc",32:"space",37:"left",38:"up",39:"right",40:"down",48:"0",49:"1",49:"1",49:"1",49:"1",49:"1",49:"6",49:"7",49:"8",57:"9",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",87:"w",88:"x",89:"y",90:"z",93:"cmd",188:",",190:"."},this.keyarray=[],i=this.mapping;for(t in i)e=i[t],this.keyarray[e]=!1;r=document.querySelector("html"),r.addEventListener("keydown",function(t){return n.keyarray[n.mapping[t.which]]=!0}),r.addEventListener("keyup",function(t){return n.keyarray[n.mapping[t.which]]=!1})}return t.prototype.key=function(t){return this.keyarray[t]},t.prototype.check=function(){return this.keyarray},t}(),e.exports=r},{}],9:[function(t,e){var r;r=function(){function t(t){var e;switch(e=t.read,this.file=t.file,this.callback=t.callback,this.mapData={},"function"==typeof e&&(this.read=e),e){case"image":this.read=this.readImage;break;case"file":this.read=this.readFile;break;default:this.read=this.readLiteral}}return t.prototype.readImage=function(){var t,e=this;return t=new Image,t.src=this.file,t.onload=function(){var r,i,n,o,s,h,a,c,u;for(r=document.createElement("canvas"),e.mapData.width=r.width=t.width,e.mapData.height=r.height=t.height,i=r.getContext("2d"),i.drawImage(t,0,0),n=i.getImageData(0,0,e.mapData.width,e.mapData.height).data,o=c=0,u=n.length;u>c;o=c+=4)s=n[o],h=Math.floor(o/4/e.mapData.width),null==(a=e.mapData)[h]&&(a[h]=[]),e.mapData[h].push([Number(n[o]).toHex(),Number(n[o+1]).toHex(),Number(n[o+2]).toHex(),Number(n[o+3]).toHex()]);return e.callback(e.mapData)}},t.prototype.readFile=function(){var t;return t=new XMLHttpRequest,t.onload=function(){return this.mapData=JSON.parse(t.responseText),this.callback(this.mapdata)},t.open("GET",this.file,!0),t.send()},t.prototype.readLiteral=function(){return this.mapData=this.file,this.callback(this.mapData)},t}(),e.exports=r},{}],10:[function(t,e){var r,i,n,o,s=function(t,e){return function(){return t.apply(e,arguments)}};r=t("./datasource.coffee"),o=t("./readstrategy.coffee"),n=t("./movementrules.coffee"),i=function(){function t(t){this.sprite=t.sprite,this.read=t.read,this.pattern=t.pattern,this.movement=t.movement,this.mapFile=t.mapFile,this.ed=t.ed,this.parseToTiles=s(this.parseToTiles,this),null==this.read&&(this.read="image"),null==this.pattern&&(this.pattern="simple"),null==this.movement&&(this.movement="northSouthEastWest"),this.width=0,this.height=0,this.rd=null,new r({read:this.read,file:this.mapFile,callback:this.parseToTiles}).read()}return t.prototype.parseToTiles=function(t){var e;return this.width=t.width,this.height=t.height,this.tiles=new o(this.pattern).read(t,this.sprite),new n(this.movement).applyRules(this),null!=(e=this.ed)?e.trigger("map.finishedLoading"):void 0},t.prototype.renderDistance=function(t){return null!=this.rd?this.rd:this.rd=(Math.pow(t.vpWidth+20,2)+Math.pow(t.vpHeight+20,2))/4},t.prototype.tileAtVector=function(t){var e,r,i;return r=Math.floor(t.x/this.sprite.innerWidth),i=Math.floor(t.y/this.sprite.innerHeight),e=i*this.width+r,this.tiles[e]},t.prototype.render=function(t,e){var r,i,n,o,s;for(o=this.tiles,s=[],i=0,n=o.length;n>i;i++)r=o[i],s.push(r.squaredDistanceTo(e.coor)<this.renderDistance(e)?r.render(t):void 0);return s},t}(),e.exports=i},{"./datasource.coffee":9,"./movementrules.coffee":11,"./readstrategy.coffee":12}],11:[function(t,e){var r;r=function(){function t(t){switch("function"==typeof t&&(this.rules=t),t){case"hexagon":this.rules=this.hexagon;break;default:this.rules=this.northSouthEastWest}}return t.prototype.applyRules=function(t){return this.rules(t)},t.prototype.northSouthEastWest=function(t){var e,r,i,n,o,s;for(o=t.tiles,s=[],e=i=0,n=o.length;n>i;e=++i)r=o[e],r.neighbor.w=t.tiles[e-1],r.neighbor.e=t.tiles[e+1],r.neighbor.n=t.tiles[e-t.width],s.push(r.neighbor.s=t.tiles[e+t.width]);return s},t.prototype.hexagon=function(){},t}(),e.exports=r},{}],12:[function(t,e){var r,i;i=t("./tile.coffee"),r=function(){function t(t){if(this.pattern=t,"function"==typeof this.pattern)this.read=this.pattern;else switch(this.pattern){case"square":this.read=this.readSquare;break;case"cross":this.read=this.readCross;break;default:this.read=this.readSimple}}return t.prototype.readSimple=function(t,e){var r,n,o,s,h,a,c,u,p,f;for(s=[],o=c=0,p=t.height-1;p>=0?p>=c:c>=p;o=p>=0?++c:--c)for(r=u=0,f=t.width-1;f>=0?f>=u:u>=f;r=f>=0?++u:--u)h=""+t[o][r][0],n=parseInt(t[o][r][1],16),a=parseInt(t[o][r][2],16),s.push(new i(e,h,o,r,n,a));return s},t.prototype.readSquare=function(t,e){var r,n,o,s,h,a,c,u,p,f;for(s=[],o=c=0,p=t.height-2;p>=0?p>=c:c>=p;o=p>=0?++c:--c)for(r=u=0,f=t.width-2;f>=0?f>=u:u>=f;r=f>=0?++u:--u)h=""+t[o][r][0]+t[o][r+1][0]+t[o+1][r][0]+t[o+1][r+1][0],n=parseInt(t[o][r][1],16),a=parseInt(t[o][r][2],16),s.push(new i(e,h,o,r,n,a));return s},t.prototype.readCross=function(t,e){var r,n,o,s,h,a,c,u,p,f;for(s=[],o=c=1,p=t.height-2;p>=c;o=c+=2)for(r=u=1,f=t.width-2;f>=u;r=u+=2)"00"!==t[o][r][0]&&(h=""+t[o-1][r][0]+t[o][r+1][0]+t[o+1][r][0]+t[o][r-1][0],n=parseInt(t[o][r][1],16),a=parseInt(t[o][r][2],16),s.push(new i(e,h,o/2,r/2,n,a)));return s},t}(),e.exports=r},{"./tile.coffee":13}],13:[function(t,e){var r,i,n;r=t("../boundingBox.coffee"),n=t("../vector.coffee"),i=function(){function t(t,e,i,o,s,h){this.sprite=t,this.type=e,this.row=i,this.col=o,this.green=null!=s?s:0,this.z=null!=h?h:0,this.neighbor=[],this.x=this.col*this.sprite.innerWidth+this.sprite.innerWidth/2,this.y=this.row*this.sprite.innerHeight+this.sprite.innerHeight/2,this.bb=new r(new n(this.x,this.y),new n(this.sprite.innerWidth,this.sprite.innerHeight))}return t.prototype.isWalkable=function(){return 0===this.green},t.prototype.squaredDistanceTo=function(t){return t.subtract(new n(this.x,this.y)).lengthSquared()},t.prototype.render=function(t){return t.save(),t.translate(this.x-this.z,this.y-this.z),this.sprite.render(this.type,t),t.restore()},t}(),e.exports=i},{"../boundingBox.coffee":1,"../vector.coffee":21}],14:[function(t,e){var r;r=function(){function t(){}return t.prototype.update=function(){},t.prototype.render=function(){},t}(),e.exports=r},{}],15:[function(t,e){var r;r=function(){function t(){this.scenes={},this.currentScene=null}return t.prototype.addScene=function(t){return this.scenes[t.name]={"class":t,instance:null}},t.prototype.setScene=function(t,e){var r;return this.currentScene=null!=(r=this.scenes[t]).instance?(r=this.scenes[t]).instance:r.instance=new this.scenes[t]["class"](e)},t}(),e.exports=r},{}],16:[function(t,e){var r,i,n;i=t("./shape.coffee"),n=t("../timer.coffee"),r=function(){function t(t,e){var r,o,s,h;this.sprite=t,this.fps=null!=(o=e.fps)?o:30,this.loop=null!=(s=e.loop)?s:!0,this.callback=null!=(h=e.callback)?h:null,this.frames=function(){var t,n,o,s;for(o=e.frames,s=[],t=0,n=o.length;n>t;t++)r=o[t],s.push(new i(this.sprite,r));return s}.call(this),this.lastFrame=this.frames.length-1,this.timer=new n,this.currentFrame=0,this.playing=!0}return t.prototype.render=function(t){return this.playing&&(this.currentFrame=Math.floor(this.timer.timeSinceLastPunch()/(1e3/this.fps)),this.currentFrame>this.lastFrame&&("function"==typeof this.callback&&this.callback(),this.loop?this.rewind():(this.currentFrame=this.lastFrame,this.stop()))),this.frames[this.currentFrame].render(t)},t.prototype.play=function(){return this.playing=!0},t.prototype.stop=function(){return this.playing=!1},t.prototype.rewind=function(){return this.currentFrame=0,this.timer.punch()},t}(),e.exports=r},{"../timer.coffee":20,"./shape.coffee":18}],17:[function(t,e){var r;r=function(){function t(t){this.sprite=t,this.sprite.addImage("background",0)}return t.prototype.render=function(t){return this.sprite.render("background",t)},t}(),e.exports=r},{}],18:[function(t,e){var r;r=function(){function t(t,e){this.sprite=t,this.sx=e*this.sprite.width%this.sprite.texWidth,this.sy=Math.floor(e*this.sprite.width/this.sprite.texWidth)*this.sprite.height}return t.prototype.render=function(t){return t.save(),t.translate(-this.sprite.width/2,-this.sprite.height/2),t.drawImage(this.sprite.texture,this.sx,this.sy,this.sprite.width,this.sprite.height,0,0,this.sprite.width,this.sprite.height),t.restore()},t}(),e.exports=r},{}],19:[function(t,e){var r,i,n;i=t("./shape.coffee"),r=t("./animation.coffee"),n=function(){function t(t){var e,r,i,n,o,s;this.assets={},this.width=t.width,this.height=t.height,this.texture=new Image,this.texture.src=t.texture,this.key=null!=(i=t.key)?i:{},n=this.key;for(r in n)e=n[r],this.addImage(r,e);this.innerWidth=null!=(o=t.innerWidth)?o:this.width,this.innerHeight=null!=(s=t.innerHeight)?s:this.height}return t.prototype.addImage=function(t,e){var r=this;return $(this.texture).load(function(){return r.texWidth=r.texture.width,r.assets[t]=new i(r,e)})},t.prototype.addAnimation=function(t,e){var i=this;return $(this.texture).load(function(){return i.texWidth=i.texture.width,i.assets[t]=new r(i,e)})},t.prototype.render=function(t,e){return null!=this.assets[t]?this.assets[t].render(e):void 0},t}(),e.exports=n},{"./animation.coffee":16,"./shape.coffee":18}],20:[function(t,e){var r;r=function(){function t(){this.last_time=(new Date).getTime(),this.delta=0}return t.prototype.punch=function(){var t;return t=(new Date).getTime(),this.delta=t-this.last_time,this.last_time=t,this.delta},t.prototype.timeSinceLastPunch=function(){var t;return t=(new Date).getTime(),t-this.last_time},t.prototype.fps=function(){return 1e3/this.delta},t}(),e.exports=r},{}],21:[function(t,e){var r;r=function(){function t(t,e){null==t&&(t=0),null==e&&(e=0),this.x=t,this.y=e}return t.prototype.clone=function(){return new t(this.x,this.y)},t.prototype.add=function(e){return new t(this.x+e.x,this.y+e.y)},t.prototype.add_=function(t){return this.x+=t.x,this.y+=t.y},t.prototype.subtract=function(e){return new t(this.x-e.x,this.y-e.y)},t.prototype.subtract_=function(t){return this.x-=t.x,this.y-=t.y},t.prototype.mult=function(e){return new t(this.x*e,this.y*e)},t.prototype.mult_=function(t){return this.x*=t,this.y*=t},t.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},t.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y},t.prototype.norm=function(t){return null==t&&(t=1),this.length()>0?this.mult(t/l):null},t.prototype.norm_=function(t){return null==t&&(t=1),this.length()>0?this.mult_(t/l):null},t.prototype.scalarProduct=function(t){return this.x*t.x+this.y*t.y},t.prototype.sameDirection=function(t){return this.lengthSquared()<this.add(t).lengthSquared()?!0:!1},t.prototype.angleWith=function(t){return Math.acos(this.scalarProduct(t)/this.length()*t.length())},t.prototype.vectorProduct=function(){return this},t.prototype.projectTo=function(t){return t.mult(this.scalarProduct(t)/t.lengthSquared())},t.prototype.projectTo_=function(t){var e;return e=this.scalarProduct(t)/t.lengthSquared(),this.x*=e,this.y*=e},t.intersecting=function(t,e,r,i){var n,o,s,h,a,c,u;return n=r.subtract(t),i=i.mult(-1),o=[],o[0]=e.clone(),o[1]=i.clone(),o[2]=n.clone(),s=0,h=1,u=2,c=o[0].y/o[0].x,o[0].y=0,o[1].y=o[1].y-c*o[1].x,o[2].y=o[2].y-c*o[2].x,a=o[u].y/o[h].y,r.subtract(i.mult(a))},t.prototype.print=function(){return"("+this.x+", "+this.y+")"},t}(),e.exports=r},{}]},{},[7])(7)});