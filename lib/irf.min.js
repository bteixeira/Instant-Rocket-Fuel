!function(t){if("object"==typeof exports)module.exports=t();else if("function"==typeof define&&define.amd)define(t);else{var e;"undefined"!=typeof window?e=window:"undefined"!=typeof global?e=global:"undefined"!=typeof self&&(e=self),e.irf=t()}}(function(){return function t(e,r,i){function n(s,h){if(!r[s]){if(!e[s]){var a="function"==typeof require&&require;if(!h&&a)return a(s,!0);if(o)return o(s,!0);throw new Error("Cannot find module '"+s+"'")}var c=r[s]={exports:{}};e[s][0].call(c.exports,function(t){var r=e[s][1][t];return n(r?r:t)},c,c.exports,t,e,r,i)}return r[s].exports}for(var o="function"==typeof require&&require,s=0;s<i.length;s++)n(i[s]);return n}({1:[function(t,e){var r,i,n;i=t("./shape.coffee"),n=t("./timer.coffee"),r=function(){function t(t,e){var r,o,s,h;this.sprite=t,this.fps=null!=(o=e.fps)?o:30,this.loop=null!=(s=e.loop)?s:!0,this.callback=null!=(h=e.callback)?h:null,this.frames=function(){var t,n,o,s;for(o=e.frames,s=[],t=0,n=o.length;n>t;t++)r=o[t],s.push(new i(this.sprite,r));return s}.call(this),this.lastFrame=this.frames.length-1,this.timer=new n,this.currentFrame=0,this.playing=!0}return t.prototype.render=function(t){return this.playing&&(this.currentFrame=Math.floor(this.timer.timeSinceLastPunch()/(1e3/this.fps)),this.currentFrame>this.lastFrame&&("function"==typeof this.callback&&this.callback(),this.loop?this.rewind():(this.currentFrame=this.lastFrame,this.stop()))),this.frames[this.currentFrame].render(t)},t.prototype.play=function(){return this.playing=!0},t.prototype.stop=function(){return this.playing=!1},t.prototype.rewind=function(){return this.currentFrame=0,this.timer.punch()},t}(),e.exports=r},{"./shape.coffee":14,"./timer.coffee":17}],2:[function(t,e){var r;r=function(){function t(t){this.sprite=t,this.sprite.addImage("background",0)}return t.prototype.render=function(t){return this.sprite.render("background",t)},t}(),e.exports=r},{}],3:[function(t,e){var r,i;i=t("./vector.coffee"),r=function(){function t(t,e,r){this.coor=t,this.dim=e,this.color=null!=r?r:"grey",null==this.coor&&(this.coor=new i),null==this.dim&&(this.dim=new i)}return t.prototype.intersect=function(t){return this.intersectv(t)&&this.intersecth(t)},t.prototype.intersectv=function(t){return this.coor.y<t.coor.y?(this.dim.y+t.dim.y)/2<t.coor.y-this.coor.y?!1:!0:(this.dim.y+t.dim.y)/2<this.coor.y-t.coor.y?!1:!0},t.prototype.intersecth=function(t){return this.coor.x<t.coor.x?(this.dim.x+t.dim.x)/2<t.coor.x-this.coor.x?!1:!0:(this.dim.x+t.dim.x)/2<this.coor.x-t.coor.x?!1:!0},t.prototype.render=function(t){return t.strokeStyle=this.color,t.strokeRect(this.coor.x-this.dim.x/2,this.coor.y-this.dim.y/2,this.dim.x,this.dim.y)},t}(),e.exports=r},{"./vector.coffee":18}],4:[function(t,e){var r,i;i=t("./vector.coffee"),r=function(){function t(t,e,r){this.coor=t,this.dim=e,this.color=null!=r?r:"grey",null==this.coor&&(this.coor=new i),null==this.dim&&(this.dim=new i)}return t.prototype.intersect=function(t){return this.intersectv(t)&&this.intersecth(t)},t.prototype.intersectv=function(t){return this.coor.y<t.coor.y?(this.dim.y+t.dim.y)/2<t.coor.y-this.coor.y?!1:!0:(this.dim.y+t.dim.y)/2<this.coor.y-t.coor.y?!1:!0},t.prototype.intersecth=function(t){return this.coor.x<t.coor.x?(this.dim.x+t.dim.x)/2<t.coor.x-this.coor.x?!1:!0:(this.dim.x+t.dim.x)/2<this.coor.x-t.coor.x?!1:!0},t.prototype.render=function(t){return t.strokeStyle=this.color,t.strokeRect(this.coor.x-this.dim.x/2,this.coor.y-this.dim.y/2,this.dim.x,this.dim.y)},t}(),e.exports=r},{"./vector.coffee":18}],5:[function(t,e){var r,i;i=t("./vector.coffee"),r=function(){function t(t){var e;this.projection=t.projection,this.vpWidth=t.vpWidth,this.vpHeight=t.vpHeight,this.zoomFactor=null!=(e=t.zoomFactor)?e:1,this.coor=new i(100,100)}return t.prototype.update=function(){},t.prototype.apply=function(t,e){switch(this.projection){case"normal":return t.save(),t.translate(this.vpWidth/2-this.coor.x,this.vpHeight/2-this.coor.y),e(),t.restore();case"iso":return t.save(),t.scale(1,.5),t.rotate(Math.PI/4),t.translate(200,-400),e(),t.restore()}},t}(),e.exports=r},{"./vector.coffee":18}],6:[function(t,e){var r;r=function(){function t(){this.eventlist={}}return t.prototype.register=function(t,e){return null==this.eventlist[t]&&(this.eventlist[t]=[]),this.eventlist[t].push(e)},t.prototype.trigger=function(t,e){var r,i,n,o,s;for(o=this.eventlist[t],s=[],i=0,n=o.length;n>i;i++)r=o[i],s.push(r(e));return s},t}(),e.exports=r},{}],7:[function(t,e){var r,i,n,o,s=function(t,e){return function(){return t.apply(e,arguments)}};n=t("./scenemanager.coffee"),i=t("./helpers.coffee"),o=t("./timer.coffee"),r=function(){function t(t){this.gameloop=s(this.gameloop,this);var e;this.params=i.extend({width:800,height:600},t),e=document.createElement("canvas"),e.setAttribute("width",this.params.width),e.setAttribute("height",this.params.height),document.querySelector("body").appendChild(e),this.ctx=e.getContext("2d"),this.ctx.font="400 18px Helvetica, sans-serif",this.loop=null,this.timer=new o,this.sceneManager=this.constructor.sceneManager||new n}return t.addScene=function(t){return null==this.sceneManager&&(this.sceneManager=new n),this.sceneManager.addScene(t)},t.prototype.gameloop=function(){return this.update(),this.render()},t.prototype.start=function(){return this.loop=setInterval(this.gameloop,1)},t.prototype.stop=function(){return this.loop.clearInterval()},t.prototype.update=function(){return this.timer.punch()},t.prototype.render=function(){return this.ctx.clearRect(0,0,this.params.width,this.params.height)},t}(),e.exports=r},{"./helpers.coffee":8,"./scenemanager.coffee":13,"./timer.coffee":17}],8:[function(t,e){var r;Array.prototype.shuffle=function(){return this.sort(function(){return.5-Math.random()})},Number.prototype.toHex=function(t){var e;for(null==t&&(t=2),e=this.toString(16);e.length<t;)e="0"+e;return e},r=function(){function t(){}return t.extend=function(t,e){var r,i;for(r in e)i=e[r],t[r]=i;return t},t}(),e.exports=r},{}],9:[function(t,e){e.exports={Animation:t("./animation.coffee"),Background:t("./background.coffee"),BoundingBox:t("./boundingbox.coffee"),Camera:t("./camera.coffee"),EventManager:t("./eventmanager.coffee"),Game:t("./game.coffee"),Helpers:t("./helpers.coffee"),Keyboard:t("./keyboard.coffee"),Map:t("./map.coffee"),Scene:t("./scene.coffee"),SceneManager:t("./scenemanager.coffee"),Shape:t("./shape.coffee"),Sprite:t("./sprite.coffee"),Tile:t("./tile.coffee"),Timer:t("./timer.coffee"),Vector:t("./vector.coffee")}},{"./animation.coffee":1,"./background.coffee":2,"./boundingbox.coffee":4,"./camera.coffee":5,"./eventmanager.coffee":6,"./game.coffee":7,"./helpers.coffee":8,"./keyboard.coffee":10,"./map.coffee":11,"./scene.coffee":12,"./scenemanager.coffee":13,"./shape.coffee":14,"./sprite.coffee":15,"./tile.coffee":16,"./timer.coffee":17,"./vector.coffee":18}],10:[function(t,e){var r;r=function(){function t(){var t,e,r,i,n=this;this.mapping={8:"backspace",9:"tab",13:"return",16:"shift",17:"ctrl",18:"alt",27:"esc",32:"space",37:"left",38:"up",39:"right",40:"down",48:"0",49:"1",49:"1",49:"1",49:"1",49:"1",49:"6",49:"7",49:"8",57:"9",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",87:"w",88:"x",89:"y",90:"z",93:"cmd",188:",",190:"."},this.keyarray=[],i=this.mapping;for(t in i)e=i[t],this.keyarray[e]=!1;r=document.querySelector("html"),r.addEventListener("keydown",function(t){return n.keyarray[n.mapping[t.which]]=!0}),r.addEventListener("keyup",function(t){return n.keyarray[n.mapping[t.which]]=!1})}return t.prototype.key=function(t){return this.keyarray[t]},t.prototype.check=function(){return this.keyarray},t}(),e.exports=r},{}],11:[function(t,e){var r,i;i=t("./tile.coffee"),r=function(){function t(t){if(this.sprite=t.sprite,this.tiles=[],this.width=0,this.height=0,"function"==typeof t.pattern)this.read=t.pattern;else switch(t.pattern){case"simple":this.read=this.readSimple;break;case"square":this.read=this.readSquare;break;case"cross":this.read=this.readCross}this.map=new Image,this.map.src=t.mapfile,this.mapData=[],this.loadMapDataFromImage()}return t.prototype.render=function(t,e){var r,i,n,o,s;for(o=this.tiles,s=[],i=0,n=o.length;n>i;i++)r=o[i],s.push(r.squaredDistanceTo(e.coor)<1e5?r.render(t):void 0);return s},t.prototype.loadMapDataFromImage=function(){var t=this;return $(this.map).load(function(){var e,r,i,n,o,s,h,a,c,u,p,f,l,d,m;for(e=document.createElement("canvas"),t.width=t.map.width,t.height=t.map.height,e.width=t.map.width,e.height=t.map.height,r=e.getContext("2d"),r.drawImage(t.map,0,0),i=r.getImageData(0,0,t.map.width,t.map.height).data,n=u=0,f=i.length;f>u;n=u+=4)s=i[n],h=Math.floor(n/4/t.map.width),null==(c=t.mapData)[h]&&(c[h]=[]),t.mapData[h].push([Number(i[n]).toHex(),Number(i[n+1]).toHex(),Number(i[n+2]).toHex(),Number(i[n+3]).toHex()]);for(t.read(),d=t.tiles,m=[],o=p=0,l=d.length;l>p;o=++p)a=d[o],a.neighbor.w=t.tiles[o-1],a.neighbor.e=t.tiles[o+1],a.neighbor.n=t.tiles[o-t.width],m.push(a.neighbor.s=t.tiles[o+t.width]);return m})},t.prototype.readSimple=function(){var t,e,r,n,o,s,h,a;for(a=[],r=s=0,h=this.map.height-1;h>=0?h>=s:s>=h;r=h>=0?++s:--s)a.push(function(){var s,h,a;for(a=[],t=s=0,h=this.map.width-1;h>=0?h>=s:s>=h;t=h>=0?++s:--s)n=""+this.mapData[r][t][0],e=parseInt(this.mapData[r][t][1],16),o=parseInt(this.mapData[r][t][2],16),a.push(this.tiles.push(new i(this.sprite,n,r,t,e,o)));return a}.call(this));return a},t.prototype.readSquare=function(){var t,e,r,n,o,s,h,a;for(a=[],r=s=0,h=this.map.height-2;h>=0?h>=s:s>=h;r=h>=0?++s:--s)a.push(function(){var s,h,a;for(a=[],t=s=0,h=this.map.width-2;h>=0?h>=s:s>=h;t=h>=0?++s:--s)n=""+this.mapData[r][t][0]+this.mapData[r][t+1][0]+this.mapData[r+1][t][0]+this.mapData[r+1][t+1][0],e=parseInt(this.mapData[r][t][1],16),o=parseInt(this.mapData[r][t][2],16),a.push(this.tiles.push(new i(this.sprite,n,r,t,e,o)));return a}.call(this));return a},t.prototype.readCross=function(){var t,e,r,n,o,s,h,a;for(a=[],r=s=1,h=this.map.height-2;h>=s;r=s+=2)a.push(function(){var s,h,a;for(a=[],t=s=1,h=this.map.width-2;h>=s;t=s+=2)"00"!==this.mapData[r][t][0]?(n=""+this.mapData[r-1][t][0]+this.mapData[r][t+1][0]+this.mapData[r+1][t][0]+this.mapData[r][t-1][0],e=parseInt(this.mapData[r][t][1],16),o=parseInt(this.mapData[r][t][2],16),a.push(this.tiles.push(new i(this.sprite,n,r/2,t/2,e,o)))):a.push(void 0);return a}.call(this));return a},t.prototype.tileAtVector=function(t){var e,r,i;return r=Math.floor(t.x/this.sprite.innerWidth),i=Math.floor(t.y/this.sprite.innerHeight),e=i*this.width+r,this.tiles[e]},t}(),e.exports=r},{"./tile.coffee":16}],12:[function(t,e){var r;r=function(){function t(){}return t.prototype.update=function(){},t.prototype.render=function(){},t}(),e.exports=r},{}],13:[function(t,e){var r;r=function(){function t(){this.scenes={},this.currentScene=null}return t.prototype.addScene=function(t){return this.scenes[t.name]={"class":t,instance:null}},t.prototype.setScene=function(t,e){var r;return this.currentScene=null!=(r=this.scenes[t]).instance?(r=this.scenes[t]).instance:r.instance=new this.scenes[t]["class"](e)},t}(),e.exports=r},{}],14:[function(t,e){var r;r=function(){function t(t,e){this.sprite=t,this.sx=e*this.sprite.width%this.sprite.texWidth,this.sy=Math.floor(e*this.sprite.width/this.sprite.texWidth)*this.sprite.height}return t.prototype.render=function(t){return t.save(),t.translate(-this.sprite.width/2,-this.sprite.height/2),t.drawImage(this.sprite.texture,this.sx,this.sy,this.sprite.width,this.sprite.height,0,0,this.sprite.width,this.sprite.height),t.restore()},t}(),e.exports=r},{}],15:[function(t,e){var r,i,n;i=t("./shape.coffee"),r=t("./animation.coffee"),n=function(){function t(t){var e,r,i,n,o,s;this.assets={},this.width=t.width,this.height=t.height,this.texture=new Image,this.texture.src=t.texture,this.key=null!=(i=t.key)?i:{},n=this.key;for(r in n)e=n[r],this.addImage(r,e);this.innerWidth=null!=(o=t.innerWidth)?o:this.width,this.innerHeight=null!=(s=t.innerHeight)?s:this.height}return t.prototype.addImage=function(t,e){var r=this;return $(this.texture).load(function(){return r.texWidth=r.texture.width,r.assets[t]=new i(r,e)})},t.prototype.addAnimation=function(t,e){var i=this;return $(this.texture).load(function(){return i.texWidth=i.texture.width,i.assets[t]=new r(i,e)})},t.prototype.render=function(t,e){return null!=this.assets[t]?this.assets[t].render(e):void 0},t}(),e.exports=n},{"./animation.coffee":1,"./shape.coffee":14}],16:[function(t,e){var r,i,n;r=t("./boundingBox.coffee"),n=t("./vector.coffee"),i=function(){function t(t,e,i,o,s,h){this.sprite=t,this.type=e,this.row=i,this.col=o,this.green=null!=s?s:0,this.z=null!=h?h:0,this.neighbor=[],this.x=this.col*this.sprite.innerWidth+this.sprite.innerWidth/2,this.y=this.row*this.sprite.innerHeight+this.sprite.innerHeight/2,this.bb=new r(new n(this.x,this.y),new n(this.sprite.innerWidth,this.sprite.innerHeight)),this.bb.color="green"}return t.prototype.isWalkable=function(){return 0===this.green},t.prototype.squaredDistanceTo=function(t){return t.subtract(new n(this.x,this.y)).lengthSquared()},t.prototype.render=function(t){return t.save(),t.translate(this.x-this.z,this.y-this.z),this.sprite.render(this.type,t),t.restore()},t}(),e.exports=i},{"./boundingBox.coffee":3,"./vector.coffee":18}],17:[function(t,e){var r;r=function(){function t(){this.last_time=(new Date).getTime(),this.delta=0}return t.prototype.punch=function(){var t;return t=(new Date).getTime(),this.delta=t-this.last_time,this.last_time=t,this.delta},t.prototype.timeSinceLastPunch=function(){var t;return t=(new Date).getTime(),t-this.last_time},t.prototype.fps=function(){return 1e3/this.delta},t}(),e.exports=r},{}],18:[function(t,e){var r;r=function(){function t(t,e){null==t&&(t=0),null==e&&(e=0),this.x=t,this.y=e}return t.prototype.clone=function(){return new t(this.x,this.y)},t.prototype.add=function(e){return new t(this.x+e.x,this.y+e.y)},t.prototype.add_=function(t){return this.x+=t.x,this.y+=t.y},t.prototype.subtract=function(e){return new t(this.x-e.x,this.y-e.y)},t.prototype.subtract_=function(t){return this.x-=t.x,this.y-=t.y},t.prototype.mult=function(e){return new t(this.x*e,this.y*e)},t.prototype.mult_=function(t){return this.x*=t,this.y*=t},t.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},t.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y},t.prototype.norm=function(t){return null==t&&(t=1),this.length()>0?this.mult(t/l):null},t.prototype.norm_=function(t){return null==t&&(t=1),this.length()>0?this.mult_(t/l):null},t.prototype.scalarProduct=function(t){return this.x*t.x+this.y*t.y},t.prototype.sameDirection=function(t){return this.lengthSquared()<this.add(t).lengthSquared()?!0:!1},t.prototype.angleWith=function(t){return Math.acos(this.scalarProduct(t)/this.length()*t.length())},t.prototype.vectorProduct=function(){return this},t.prototype.projectTo=function(t){return t.mult(this.scalarProduct(t)/t.lengthSquared())},t.prototype.projectTo_=function(t){var e;return e=this.scalarProduct(t)/t.lengthSquared(),this.x*=e,this.y*=e},t.intersecting=function(t,e,r,i){var n,o,s,h,a,c,u;return n=r.subtract(t),i=i.mult(-1),o=[],o[0]=e.clone(),o[1]=i.clone(),o[2]=n.clone(),s=0,h=1,u=2,c=o[0].y/o[0].x,o[0].y=0,o[1].y=o[1].y-c*o[1].x,o[2].y=o[2].y-c*o[2].x,a=o[u].y/o[h].y,r.subtract(i.mult(a))},t.prototype.print=function(){return"("+this.x+", "+this.y+")"},t}(),e.exports=r},{}]},{},[9])(9)});